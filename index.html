<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MedSpa SEO Dashboard</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <style>
    body{font-family:'Inter',sans-serif}
    .loader-container{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh}
    .loader{border:4px solid #f3f3f3;border-top:4px solid #3498db;border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite}
    @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
  </style>

  <!-- React (jsDelivr, CORS-friendly) -->
  <script crossorigin src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>

  <!-- Babel for in-page JSX -->
  <script src="https://unpkg.com/@babel/standalone@7.23.1/babel.min.js"></script>

  <!-- Recharts (latest 2.x UMD build, no crossorigin needed) -->
  <script src="https://cdn.jsdelivr.net/npm/recharts@2.15.4/umd/Recharts.min.js"></script>
</head>

<body class="bg-gray-50">
  <div id="root">
    <div class="loader-container">
      <div class="loader"></div>
      <p class="text-gray-500 mt-4">Loading Application...</p>
    </div>
  </div>

  <!-- Main React Application -->
  <script type="text/babel">
    const { useState, useEffect, Fragment } = React;

    /* -------------------- shell waits for libs -------------------- */
    const AppContainer = () => {
      const [libsLoaded, setLibsLoaded] = useState(false);
      const [libError,  setLibError]   = useState(null);

      useEffect(() => {
        const start = Date.now();
        const interval = setInterval(() => {
          if (window.React && window.ReactDOM && window.Recharts) {
            setLibsLoaded(true);
            clearInterval(interval);
          } else if (Date.now() - start > 10_000) {
            setLibError('Failed to load libraries from CDN.');
            clearInterval(interval);
          }
        }, 100);
        return () => clearInterval(interval);
      }, []);

      if (libError) {
        return (
          <div className="loader-container">
            <p className="text-red-500">{libError}</p>
          </div>
        );
      }
      if (!libsLoaded) {
        return (
          <div className="loader-container">
            <div className="loader"></div>
            <p className="text-gray-500 mt-4">Initializing Libraries...</p>
          </div>
        );
      }
      return <App />;
    };
    /* --------------------   end shell   -------------------- */

    /* ---------- helpers for SVG icons, cards, etc. ---------- */
    const createIcon = path => props => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
           viewBox="0 0 24 24" fill="none" stroke="currentColor"
           strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        {path}
      </svg>
    );
    const Info = createIcon(<><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></>);
    /* … keep your other icon definitions exactly as before … */

    const Card        = ({children,className=''}) => <div className={`bg-white rounded-xl shadow-md p-6 ${className}`}>{children}</div>;
    const PageContent = ({children}) => <main className="flex-1 p-4 sm:p-6 lg:p-8">{children}</main>;

    /* ------------------   PAGES (placeholders)   ----------------- */
    const Dashboard        = ({setActiveTab,appData}) => <PageContent><div className="p-8 text-center text-gray-500">Dashboard Content Placeholder</div></PageContent>;
    const WebsiteStatsPage = ({data})                  => <PageContent><div className="p-8 text-center text-gray-500">Website Stats Placeholder</div></PageContent>;
    const GeogridMapsPage  = ({appData})               => <PageContent><div className="p-8 text-center text-gray-500">Geogrid Maps Placeholder</div></PageContent>;
    const KeywordsPage     = ({data})                  => <PageContent><div className="p-8 text-center text-gray-500">Keywords Placeholder</div></PageContent>;
    const BacklinksPage    = ({data})                  => <PageContent><div className="p-8 text-center text-gray-500">Backlinks Placeholder</div></PageContent>;

    /* ------------------------   HEADER   ------------------------- */
    const Header = ({activeTab,setActiveTab}) => {
      const tabs = ['Dashboard','Website Stats','Geogrid Maps','Keywords','Backlinks','Tools'];
      return (
        <header className="bg-white shadow-sm sticky top-0 z-20">
          <nav className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div className="flex items-center justify-between h-16">
              <div className="flex items-center">
                <svg className="h-8 w-8" viewBox="0 0 24 24" fill="none"
                     stroke="url(#logo-gradient)" strokeWidth="2"
                     strokeLinecap="round" strokeLinejoin="round">
                  <defs>
                    <linearGradient id="logo-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                      <stop offset="0%" style={{stopColor:'#3b82f6'}} />
                      <stop offset="100%" style={{stopColor:'#ec4899'}} />
                    </linearGradient>
                  </defs>
                  <path d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                </svg>
                <h1 className="text-xl font-bold ml-3 bg-gradient-to-r from-blue-500 to-pink-500 bg-clip-text text-transparent">MedSpa SEO</h1>
              </div>
              <div className="hidden md:block">
                <div className="ml-10 flex items-baseline space-x-4">
                  {tabs.map(tab => (
                    <button key={tab}
                            onClick={() => setActiveTab(tab)}
                            className={`px-3 py-2 rounded-md text-sm font-medium
                            ${activeTab===tab ? 'bg-blue-600 text-white'
                                               : 'text-gray-500 hover:bg-gray-100 hover:text-gray-900'}`}>
                      {tab}
                    </button>
                  ))}
                </div>
              </div>
            </div>
          </nav>
        </header>
      );
    };

    /* -------------------------   MAIN APP   ---------------------- */
    const App = () => {
      const [activeTab,setActiveTab] = useState('Dashboard');
      const [appData, setAppData]    = useState(null);
      const [loading, setLoading]    = useState(true);
      const [error,   setError]      = useState(null);

      useEffect(() => {
        const params     = new URLSearchParams(window.location.search);
        const workbookId = params.get('workbookId');
        if (!workbookId) {
          setError("No workbook ID provided in the URL. Please add '?workbookId=YOUR_ID' to the end of the URL.");
          setLoading(false);
          return;
        }

        const scriptUrl = `https://script.google.com/macros/s/AKfycbxfOMp8d_eCVH4lFD0PNuFU1wH-gyWOwRt2EuME7GQJ4U73ZwpPDciohDH3C566YLWq/exec?workbookId=${workbookId}`;

        fetch(scriptUrl)                     /* GET (Apps-Script doGet) */
          .then(r => r.json())
          .then(data => {
            if (data.error) throw new Error(`Script error: ${data.error}`);
            setAppData(data);
            setLoading(false);
          })
          .catch(err => {
            console.error('Fetch Error:', err);
            setError(err.message);
            setLoading(false);
          });
      }, []);

      const renderContent = () => {
        if (loading)  return <PageContent><div className="p-8 text-center text-gray-500">Loading live data from your workbook…</div></PageContent>;
        if (error)    return <PageContent><div className="p-8 text-center text-red-500">Error: {error}</div></PageContent>;
        if (!appData) return <PageContent><div className="p-8 text-center text-gray-500">No data found.</div></PageContent>;

        switch (activeTab) {
          case 'Keywords':      return <KeywordsPage  data={appData} />;
          case 'Backlinks':     return <BacklinksPage data={appData} />;
          case 'Geogrid Maps':  return <GeogridMapsPage appData={appData} />;
          case 'Website Stats': return <WebsiteStatsPage data={appData.websiteStats} />;
          case 'Tools':         return <PageContent><div className="p-8 text-center text-gray-500">Tools Page Coming Soon…</div></PageContent>;
          default:              return <Dashboard setActiveTab={setActiveTab} appData={appData} />;
        }
      };

      return (
        <div className="min-h-screen bg-gray-50 font-sans">
          <Header activeTab={activeTab} setActiveTab={setActiveTab} />
          {renderContent()}
        </div>
      );
    };

    /* boot */
    ReactDOM.createRoot(document.getElementById('root')).render(<AppContainer />);
  </script>
</body>
</html>
